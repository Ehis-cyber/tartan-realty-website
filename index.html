<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Welcome â€” Tartan Realty</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="Fonts/WEB/css/outfit.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="styles_modern.css">
  </head>
  <body class="welcome-page">

    <!-- Video background (will gracefully fall back to Ken Burns background if no file present) -->
    <video class="video-bg" id="heroVideo" autoplay muted loop playsinline poster="Images/danny-greenberg-jZmlo4FXJUI-unsplash.jpg">
      <source src="Images/hero-loop.webm" type="video/webm">
      <source src="Images/hero-loop.mp4" type="video/mp4">
      <!-- If user hasn't provided a video, the poster image and kenburns CSS will be visible -->
    </video>

    <!-- Ken Burns fallback background (styles.css includes .kenburns-bg) -->
    <div class="kenburns-bg" aria-hidden="true"></div>
    <div class="welcome-overlay" aria-hidden="true"></div>

    <div class="welcome-content">
      <img src="logo-reference-based.svg" alt="Tartan Realty logo" class="welcome-logo">
      <h1>Tartan Realty & Investments Limited</h1>
      <p>Transforming properties across the United Kingdom</p>

      <a class="enter-btn" href="index-book.html" id="enterBtn">Enter</a>
      <footer class="welcome-footer">
        <small>Â© Tartan Realty & Investments Limited</small>
      </footer>
    </div>

    <!-- keep arrow cursor element available -->
    <div class="custom-cursor" id="customCursor"></div>

    <!-- overlay used for expanding transition animation -->
    <div id="pageOverlay" class="page-overlay" aria-hidden="true"></div>

    <script>
      (function(){
        const v = document.getElementById('heroVideo');
        const btn = document.getElementById('enterBtn');
        const overlay = document.getElementById('pageOverlay');
        if(v && !v.querySelector('source')) v.style.display = 'none';

        if(btn && overlay){
          btn.addEventListener('click', function(e){
            e.preventDefault();
            const rect = btn.getBoundingClientRect();
            const x = rect.left + rect.width/2;
            const y = rect.top + rect.height/2;
            overlay.style.left = x + 'px';
            overlay.style.top = y + 'px';
            overlay.classList.add('expand');
            setTimeout(()=>{ window.location.href = btn.getAttribute('href'); }, 700);
          });
        }
      })();
    </script>

  </body>
</html>

        function openBook() {
            const cover = document.querySelector('.book-cover');
            const book = document.querySelector('.book');
            
            cover.style.transform = 'rotateY(-180deg)';
            setTimeout(() => {
                cover.style.display = 'none';
                book.style.display = 'block';
                book.classList.add('opened');
                bookOpened = true;
                showPage(0);
            }, 800);
        }

        function showPage(pageIndex) {
            // Hide all pages
            const pages = document.querySelectorAll('.page');
            const tabs = document.querySelectorAll('.tab');
            
            pages.forEach((page, index) => {
                if (index === pageIndex) {
                    page.classList.add('active');
                    page.style.transform = 'rotateY(0deg)';
                    page.style.zIndex = 10;
                } else if (index < pageIndex) {
                    page.classList.remove('active');
                    page.style.transform = 'rotateY(-180deg)';
                    page.style.zIndex = index;
                } else {
                    page.classList.remove('active');
                    page.style.transform = 'rotateY(0deg)';
                    page.style.zIndex = totalPages - index;
                }
            });

            // Update active tab
            tabs.forEach((tab, index) => {
                if (index === pageIndex) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });

            currentPage = pageIndex;
        }

        function nextPage() {
            if (currentPage < totalPages - 1) {
                showPage(currentPage + 1);
            }
        }

        function prevPage() {
            if (currentPage > 0) {
                showPage(currentPage - 1);
            }
        }

        // Initialize book
        document.addEventListener('DOMContentLoaded', function() {
            // Add tab click listeners
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach((tab, index) => {
                tab.addEventListener('click', () => {
                    if (bookOpened) {
                        showPage(index);
                    }
                });
            });

            // Add keyboard navigation
            document.addEventListener('keydown', (e) => {
                // Don't trigger navigation if user is typing in form fields
                const isFormElement = e.target.tagName === 'INPUT' || 
                                    e.target.tagName === 'TEXTAREA' || 
                                    e.target.tagName === 'SELECT' ||
                                    e.target.isContentEditable;
                
                if (bookOpened && !isFormElement) {
                    if (e.key === 'ArrowRight' || e.key === ' ') {
                        e.preventDefault(); // Prevent default spacebar behavior
                        nextPage();
                    } else if (e.key === 'ArrowLeft') {
                        e.preventDefault();
                        prevPage();
                    }
                }
            });

            // Form submission - Handle success state locally
            const form = document.getElementById('appointmentForm');
            if (form) {
                form.addEventListener('submit', (e) => {
                    // Show loading state
                    const submitBtn = form.querySelector('.book-submit-btn');
                    const originalText = submitBtn.textContent;
                    submitBtn.textContent = 'ðŸ“¤ Sending...';
                    submitBtn.disabled = true;
                    
                    // After form submits successfully, show thank you page and reset form
                    setTimeout(() => {
                        // Reset the form
                        form.reset();
                        
                        // Show thank you page
                        showPage(5);
                        
                        // Reset button state
                        submitBtn.textContent = originalText;
                        submitBtn.disabled = false;
                    }, 1500); // Give time for Formspree to process
                });
            }

            // Check URL hash on page load for direct thank-you page access
            function checkUrlHash() {
                if (window.location.hash === '#thank-you') {
                    if (bookOpened) {
                        showPage(5);
                    }
                }
            }

            // Listen for hash changes
            window.addEventListener('hashchange', checkUrlHash);
            
            // Check on initial load
            setTimeout(checkUrlHash, 1000);

            // Add touch/swipe support for mobile
            let startX = 0;
            let endX = 0;

            document.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
            });

            document.addEventListener('touchend', (e) => {
                endX = e.changedTouches[0].clientX;
                handleSwipe();
            });

            function handleSwipe() {
                if (bookOpened) {
                    const swipeThreshold = 50;
                    const diff = startX - endX;

                    if (Math.abs(diff) > swipeThreshold) {
                        if (diff > 0) {
                            // Swipe left - next page
                            nextPage();
                        } else {
                            // Swipe right - previous page
                            prevPage();
                        }
                    }
                }
            }

            // Enhanced mobile functionality
            function enhanceMobileExperience() {
                // Add haptic feedback for supported devices
                if ('vibrate' in navigator) {
                    document.querySelectorAll('.tab').forEach(tab => {
                        tab.addEventListener('touchstart', () => {
                            navigator.vibrate(10); // Subtle haptic feedback
                        });
                    });
                }

                // Improve scrolling for mobile
                const pages = document.querySelectorAll('.page');
                pages.forEach(page => {
                    page.style.scrollBehavior = 'smooth';
                });

                // Handle orientation changes
                window.addEventListener('orientationchange', () => {
                    setTimeout(() => {
                        // Recalculate dimensions after orientation change
                        const book = document.getElementById('book');
                        if (book) {
                            book.style.transform = 'perspective(1200px) rotateY(0deg)';
                        }
                    }, 100);
                });

                // Add loading states for images
                const images = document.querySelectorAll('img');
                images.forEach(img => {
                    if (!img.complete) {
                        img.style.opacity = '0.5';
                        img.addEventListener('load', () => {
                            img.style.opacity = '1';
                            img.style.transition = 'opacity 0.3s ease';
                        });
                    }
                });

                // Optimize for iOS Safari
                if (navigator.userAgent.includes('Safari') && !navigator.userAgent.includes('Chrome')) {
                    document.body.style.webkitUserSelect = 'none';
                    document.body.style.webkitTouchCallout = 'none';
                }
            }

            // Initialize mobile enhancements
            enhanceMobileExperience();

            // Modern expandable navigation functionality
            function initModernNavigation() {
                const navToggle = document.getElementById('navToggle');
                const navTabs = document.getElementById('navTabs');
                const navItems = document.getElementById('navItems');
                let isExpanded = false;

                if (navToggle) {
                    navToggle.addEventListener('click', (e) => {
                        e.stopPropagation();
                        isExpanded = !isExpanded;
                        
                        if (isExpanded) {
                            navTabs.classList.add('expanded');
                            // Auto-collapse after 10 seconds
                            setTimeout(() => {
                                if (isExpanded) {
                                    collapseNav();
                                }
                            }, 10000);
                        } else {
                            collapseNav();
                        }
                        
                        // Haptic feedback
                        if ('vibrate' in navigator) {
                            navigator.vibrate(15);
                        }
                    });
                }

                // Close navigation when clicking outside
                document.addEventListener('click', (e) => {
                    if (isExpanded && !navTabs.contains(e.target)) {
                        collapseNav();
                    }
                });

                // Close navigation when tab is clicked
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        setTimeout(() => {
                            collapseNav();
                        }, 500); // Small delay for smooth transition
                    });
                });

                function collapseNav() {
                    isExpanded = false;
                    navTabs.classList.remove('expanded');
                }

                // Auto-show navigation hint on page load
                if (window.innerWidth <= 768) {
                    setTimeout(() => {
                        navToggle.style.animation = 'pulse 0.6s ease-in-out 3';
                    }, 2000);
                }
            }

            // Initialize modern navigation
            initModernNavigation();

            // Moving Arrow that follows mouse/touch movement
            const movingArrow = document.getElementById('customCursor');
            let mouseX = 0, mouseY = 0;
            let arrowX = 0, arrowY = 0;
            let lastMouseX = 0, lastMouseY = 0;

            // Enable moving arrow on all devices
            const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            
            // Show moving arrow on all devices
            movingArrow.style.display = 'block';

            // Universal arrow animation function (works for both desktop and mobile)
            function animateArrow() {
                const speed = 0.12; // Slightly slower for smoother follow
                arrowX += (mouseX - arrowX) * speed;
                arrowY += (mouseY - arrowY) * speed;
                
                movingArrow.style.left = arrowX + 'px';
                movingArrow.style.top = arrowY + 'px';
                
                requestAnimationFrame(animateArrow);
            }
            animateArrow(); // Start animation for all devices

            // Calculate arrow direction and rotation
            function updateArrowDirection(newX, newY) {
                const deltaX = newX - lastMouseX;
                const deltaY = newY - lastMouseY;
                const angle = Math.atan2(deltaY, deltaX) * 180 / Math.PI;
                
                // Update arrow rotation to point in movement direction
                if (Math.abs(deltaX) > 2 || Math.abs(deltaY) > 2) {
                    movingArrow.style.transform = `translate(-50%, -50%) rotate(${angle}deg)`;
                }
                
                lastMouseX = newX;
                lastMouseY = newY;
            }
            
            if (!isTouchDevice) {
                // Desktop-specific features
                // Track mouse movement and calculate direction
                document.addEventListener('mousemove', (e) => {
                    mouseX = e.clientX;
                    mouseY = e.clientY;
                    updateArrowDirection(mouseX, mouseY);
                    
                    // Create occasional sparkle trail
                    createSparkleTrail(mouseX, mouseY);
                });

                // Create sparkle trail
                function createSparkleTrail(x, y) {
                    if (Math.random() < 0.2) { // 20% chance for sparkles
                        const sparkle = document.createElement('div');
                        sparkle.className = 'cursor-trail';
                        sparkle.style.left = (x + (Math.random() - 0.5) * 10) + 'px';
                        sparkle.style.top = (y + (Math.random() - 0.5) * 10) + 'px';
                        document.body.appendChild(sparkle);
                        
                        // Animate sparkle
                        setTimeout(() => {
                            sparkle.style.opacity = '0';
                            sparkle.style.transform = `scale(0)`;
                        }, 100);
                        
                        // Remove sparkle
                        setTimeout(() => {
                            if (sparkle.parentNode) {
                                sparkle.parentNode.removeChild(sparkle);
                            }
                        }, 500);
                    }
                }

                // Hover effects for interactive elements
                const interactiveElements = document.querySelectorAll('a, button, .tab, .logo-large, .service-item, input, textarea');
                
                interactiveElements.forEach(element => {
                    element.addEventListener('mouseenter', () => {
                        movingArrow.classList.add('hover');
                    });
                    
                    element.addEventListener('mouseleave', () => {
                        movingArrow.classList.remove('hover');
                    });
                });

                // Click animation
                document.addEventListener('mousedown', () => {
                    movingArrow.classList.add('click');
                });
                
                document.addEventListener('mouseup', () => {
                    movingArrow.classList.remove('click');
                });

                // Hide arrow when leaving window
                document.addEventListener('mouseleave', () => {
                    movingArrow.style.opacity = '0';
                });

                document.addEventListener('mouseenter', () => {
                    movingArrow.style.opacity = '1';
                });
            } else {
                // Mobile-specific features
                // Track touch movement (allow scrolling)
                document.addEventListener('touchmove', (e) => {
                    // Only track cursor movement, don't prevent scrolling
                    if (e.touches[0]) {
                        mouseX = e.touches[0].clientX;
                        mouseY = e.touches[0].clientY;
                        updateArrowDirection(mouseX, mouseY);
                    }
                }, { passive: true }); // Allow passive scrolling

                // Track touch start
                document.addEventListener('touchstart', (e) => {
                    if (e.touches[0]) {
                        mouseX = e.touches[0].clientX;
                        mouseY = e.touches[0].clientY;
                        movingArrow.classList.add('click');
                        movingArrow.style.opacity = '1';
                    }
                });
                
                document.addEventListener('touchend', () => {
                    movingArrow.classList.remove('click');
                });

                // Show arrow initially on mobile
                movingArrow.style.opacity = '1';
                
                // Set initial position to center of screen on mobile
                mouseX = window.innerWidth / 2;
                mouseY = window.innerHeight / 2;
            }
        });
    </script>
</body>
</html>